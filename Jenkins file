### Jenkins file ###
pipeline {
  agent any

  environment {
    DOCKER_USER = "keerthivarudu"
  }

  stages {

    stage("Checkout Code") {
      steps {
        git "https://github.com/KeerthiVarudu/Jenkins-CICD-Devops_Project.git"
      }
    }

    stage("Build Java App") {
      steps {
        dir("java-app") {
          sh "mvn clean package"
        }
      }
    }

    

    stage("Docker Build") {
      steps {
        sh "docker build -t $DOCKER_USER/java-app:latest java-app/"
            }
    }

    stage("Docker Push") {
      steps {
        sh "docker push $DOCKER_USER/java-app:latest"
            }
    }

    stage("Deploy to Kubernetes") {
      steps {
        sh "kubectl apply -f k8s-manifests/"
      }
    }
  }
}
